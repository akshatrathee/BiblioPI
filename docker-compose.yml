version: '3.8'

services:
  bibliopi:
    build: .
    container_name: bibliopi_app
    ports:
      - "9090:80"
    volumes:
      - ./data:/app/data
      - ./backups:/app/backups
    environment:
      - NODE_ENV=production
      - DATABASE_URL=sqlite:///app/data/library.db
    restart: always
  # Optional Tailscale Sidecar (Highly Recommended)
  # tailscale:
  #   image: tailscale/tailscale:latest
  #   container_name: tailscale
  #   hostname: bibliopi
  #   environment:
  #     - TS_AUTHKEY=your-auth-key
  #     - TS_STATE_DIR=/var/lib/tailscale
  #   volumes:
  #     - ./tailscale:/var/lib/tailscale
  #     - /dev/net/tun:/dev/net/tun
  #   cap_add:
  #     - NET_ADMIN
  #   restart: always
